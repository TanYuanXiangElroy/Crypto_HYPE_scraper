from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.common.exceptions import TimeoutException
from scraper.driver import get_webdriver
from config import SCRAPER_CONFIG
from scraper.exceptions import ScrapingError

# REPLACE THE URL BELOW WITH THE CORRECT WEBSITE URL FOR HYPE/USDC
# REPLACE "LINK" WITH THE ACTUAL URL
# REPLACE all WEBSITE-REPLACE with the correct website name and debug_screenshot_WEBSITE-REPLACE.png
# REPLACE THE XPATH BELOW WITH THE CORRECT XPATH TO THE PRICE ELEMENT

def scrape():
    """Scrapes HYPE price from WEBSITE-REPLACE using Selenium in headless mode."""
    
     logging.info("Scraping WEBSITE-REPLACE...")
    config = SCRAPER_CONFIG['WEBSITE-REPLACE']
    driver = get_webdriver()
    try:
        print(f"   Getting URL: {url}")
        driver.get(url)

        # Wait up to 20 seconds for the element with the price to appear
        wait = WebDriverWait(driver, 20)
        price_element = wait.until(EC.presence_of_element_located((By.XPATH , config['selector'])))
        
        # This part depends heavily on the site. You might need to get a 'value' or 'innerText'.
        price_text = price_element.get_attribute('value') or price_element.text
        
        # Clean the extracted text to get a number
        price = float(price_text.replace('$', '').strip())
        return {'price': price}
        
    except TimeoutException:
        logging.error("Error scraping Based.one: Timed out waiting for price element.")
        driver.save_screenshot('debug_screenshot_based.png')
        logging.info("   Screenshot saved as debug_screenshot_based.png for inspection.")
        raise ScrapingError("Timed out waiting for price element on Based.one")
    except Exception as e:
        logging.error(f"Error scraping Based.one: {e}")
        raise ScrapingError(f"An unexpected error occurred on Based.one: {e}")
    finally:
        driver.quit()